# DATARMOR Makefile for Apecosm (trunk)
# Tested with the following module:
# > module purge
# > module load NETCDF/4.3.3.1-mpt-intel2016
# Nicolas Barrier

EXENAME = compute_par.exe

###################################
##### DEFINITION OF MAKE VAR. #####
###################################

# According to PCIM documentation (datarmor_quickstart.pdf, page 14),
# compilation should be done by using CC $MPI_LIBS instead of mpiCC
CC = icpc    # cpp compilator
AR = ar      # linker of .o into .a
ARFLAGS = r   # ar flag
RM = rm       # rm alias
RMFLAGS = -fv   # rm options 
LINKMAIN = icpc   # main linker 
LINK = icpc    # linker
MKDIR = mkdir -p

###################################################
##### EXTERNAL LIBRARIES (MPI, BOOST, NETCDF) #####
###################################################

### BOOST path
BOOST = $(HOME)/libs/cpp/boost_1_66_0/
INCBOOST = -I$(BOOST)

### Netcdf
# $(NETCDF_DIR) automatically set up by Datarmor
LIBNETCDF = -L$(NETCDF_DIR)/lib -lnetcdf -lhdf5_hl -lhdf5 -lcurl -lz

# On Datarmor, when loading the proper NetCDF module, MPI path are automatically
# set up (cf. quickstart, page 11).
INCNETCDF = -I$(NETCDF_DIR)/include

# $(MPI_LIBS) automatically set up by Datarmor
LIBMPI = $(MPI_LIBS)

# External libraries to load
LIBS = $(LIBNETCDF) $(LIBMPI)

# Optimisation flags
OPTFLAGS = -xCORE-AVX2 -O3 -std=c++11

# Warning flags
WFLAGS = #-Wall -g qopt-report-phase=vec -qopt-report=5-qopt-report-phase=vec -qopt-report=5 

# compilation flags
CPPFLAGS = $(WFLAGS) $(OPTFLAGS)

# $(MPI_LIBS) automatically set up
LIBMPI = $(MPI_LIBS)

# External libraries to load
LIBS = $(LIBNETCDF) $(LIBMPI) $(LIBBOOST)

# Compilation options
CFLAGS = $(CPPFLAGS)

# Linking options
LNFLAGS = $(CPPFLAGS)
